{
    "description": "Streaming schema for Spymaster HUD. Defines EXACTLY what backend streams to frontend for visualization.",
    "protocol": {
        "transport": "WebSocket",
        "endpoint": "ws://localhost:8000/v1/hud/stream",
        "format": "Arrow IPC",
        "cadence": "1 second windows",
        "framing": {
            "control_frames": [
                {
                    "type": "batch_start",
                    "fields": [
                        "window_end_ts_ns",
                        "surfaces"
                    ],
                    "desc": "Marks new window and lists surfaces included in this batch"
                },
                {
                    "type": "surface_header",
                    "fields": [
                        "surface",
                        "window_end_ts_ns"
                    ],
                    "desc": "Header immediately preceding the binary Arrow IPC payload for the surface"
                }
            ],
            "binary_frame": "Arrow IPC stream for the surface named in the preceding surface_header"
        }
    },
    "streams": {
        "snap": {
            "description": "Top-of-Book snapshot. Provides spot price anchor for visualization.",
            "rows_per_window": 1,
            "fields": [
                {
                    "name": "window_end_ts_ns",
                    "type": "long",
                    "required": true,
                    "desc": "Window end timestamp (ns)"
                },
                {
                    "name": "mid_price",
                    "type": "double",
                    "required": true,
                    "desc": "Mid price for spot line. Frontend uses this for price axis."
                },
                {
                    "name": "spot_ref_price_int",
                    "type": "long",
                    "required": true,
                    "desc": "Tick-aligned spot anchor (integer)."
                },
                {
                    "name": "book_valid",
                    "type": "boolean",
                    "required": true,
                    "desc": "False during snapshot recovery"
                }
            ],
            "frontend_usage": {
                "component": "state.ts:setSpotData, main.ts:spotEl",
                "purpose": "Draws cyan spot price line, updates spot metric display"
            }
        },
        "wall": {
            "description": "Liquidity Wall. Resting order depth per price level.",
            "rows_per_window": "variable (one per active price level within ±400 ticks)",
            "spatial": true,
            "fields": [
                {
                    "name": "window_end_ts_ns",
                    "type": "long",
                    "required": true,
                    "desc": "Window timestamp"
                },
                {
                    "name": "rel_ticks",
                    "type": "int",
                    "required": true,
                    "desc": "Ticks from spot. +N = above, -N = below"
                },
                {
                    "name": "side",
                    "type": "string",
                    "required": true,
                    "desc": "'A' (ask/blue) or 'B' (bid/red)"
                },
                {
                    "name": "depth_qty_rest",
                    "type": "double",
                    "required": true,
                    "desc": "Resting depth (orders >500ms old). Used for intensity."
                },
                {
                    "name": "add_qty",
                    "type": "double",
                    "required": false,
                    "desc": "New orders added"
                },
                {
                    "name": "pull_qty_total",
                    "type": "double",
                    "required": false,
                    "desc": "Total cancellations"
                },
                {
                    "name": "d1_depth_qty",
                    "type": "double",
                    "required": false,
                    "desc": "Depth velocity"
                },
                {
                    "name": "d2_depth_qty",
                    "type": "double",
                    "required": false,
                    "desc": "Depth acceleration"
                }
            ],
            "frontend_usage": {
                "component": "renderer.ts:updateWall",
                "purpose": "Blue/red liquidity heatmap. Intensity = log1p(depth_qty_rest)."
            }
        },
        "vacuum": {
            "description": "Vacuum Physics. Normalized pull forces indicating liquidity erosion.",
            "rows_per_window": "variable (one per active price level within ±400 ticks)",
            "spatial": true,
            "fields": [
                {
                    "name": "window_end_ts_ns",
                    "type": "long",
                    "required": true,
                    "desc": "Window timestamp"
                },
                {
                    "name": "rel_ticks",
                    "type": "int",
                    "required": true,
                    "desc": "Ticks from spot"
                },
                {
                    "name": "vacuum_score",
                    "type": "double",
                    "required": true,
                    "desc": "Normalized 0-1. Higher = more vacuum (liquidity eroding)."
                },
                {
                    "name": "d2_pull_add_log",
                    "type": "double",
                    "required": false,
                    "desc": "Acceleration of pull/add ratio (Turbulence)"
                },
                {
                    "name": "wall_erosion",
                    "type": "double",
                    "required": false,
                    "desc": "Rate of wall decay"
                }
            ],
            "frontend_usage": {
                "component": "renderer.ts:updateVacuum",
                "purpose": "Black overlay on wall. Alpha = vacuum_score * 128."
            }
        },
        "physics": {
            "description": "Aggregated physics bands. Directional pressure indicators.",
            "rows_per_window": 1,
            "fields": [
                {
                    "name": "window_end_ts_ns",
                    "type": "long",
                    "required": true,
                    "desc": "Window timestamp"
                },
                {
                    "name": "mid_price",
                    "type": "double",
                    "required": true,
                    "desc": "Spot price (backup if snap missing)"
                },
                {
                    "name": "above_score",
                    "type": "double",
                    "required": true,
                    "desc": "Ease-of-movement up. 0-1. High = bullish."
                },
                {
                    "name": "below_score",
                    "type": "double",
                    "required": true,
                    "desc": "Ease-of-movement down. 0-1. High = bearish."
                }
            ],
            "frontend_usage": {
                "component": "renderer.ts:updatePhysics, state.ts:setPhysicsData",
                "purpose": "Directional pressure gradient layer. Green above spot = easy to move up. Red below spot = easy to move down. Also backup spot source."
            }
        },
        "gex": {
            "description": "Gamma Exposure surface from 0DTE options.",
            "rows_per_window": 25,
            "spatial": true,
            "grid": "±60 points from spot in 5-point steps",
            "fields": [
                {
                    "name": "window_end_ts_ns",
                    "type": "long",
                    "required": true,
                    "desc": "Window timestamp"
                },
                {
                    "name": "strike_points",
                    "type": "double",
                    "required": true,
                    "desc": "Strike price for Y-axis"
                },
                {
                    "name": "underlying_spot_ref",
                    "type": "double",
                    "required": true,
                    "desc": "Futures spot. Used if snap missing."
                },
                {
                    "name": "spot_ref_price_int",
                    "type": "long",
                    "required": true,
                    "desc": "Tick-aligned spot anchor (integer)."
                },
                {
                    "name": "rel_ticks",
                    "type": "int",
                    "required": true,
                    "desc": "Ticks relative to spot_ref_price_int."
                },
                {
                    "name": "gex_abs",
                    "type": "double",
                    "required": true,
                    "desc": "Absolute GEX. Used for intensity."
                },
                {
                    "name": "gex",
                    "type": "double",
                    "required": true,
                    "desc": "Signed GEX. Positive=call-heavy, negative=put-heavy."
                },
                {
                    "name": "gex_imbalance_ratio",
                    "type": "double",
                    "required": true,
                    "desc": "-1 to +1. Positive=call-heavy (green), negative=put-heavy (red)."
                },
                {
                    "name": "d1_gex",
                    "type": "double",
                    "required": false,
                    "desc": "GEX Velocity"
                }
            ],
            "frontend_usage": {
                "component": "renderer.ts:createHeatmap, state.ts:setGexData",
                "purpose": "GEX heatmap overlay. Green=calls, red=puts."
            }
        }
    },
    "constants": {
        "PRICE_SCALE": 1e-9,
        "TICK_SIZE": 0.25,
        "WINDOW_NS": 1000000000
    }
}