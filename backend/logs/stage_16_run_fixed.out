2025-12-29 16:03:40,551 - [3.0.0] Starting pipeline: es_pipeline
2025-12-29 16:03:40,551 - [3.0.0] Date: 2025-12-16
2025-12-29 16:03:40,551 - [3.0.0] Stages: 18
2025-12-29 16:03:40,551 - [3.0.0] Checkpointing enabled: data/checkpoints
2025-12-29 16:03:40,551 - [3.0.0] Resuming from stage 16
2025-12-29 16:03:40,551 - Loading checkpoint from stage 15: filter_rth
2025-12-29 16:03:41,950 - [3.0.0] Will stop after stage 16
2025-12-29 16:03:41,950 - [3.0.0] (17/18) Running: materialize_state_table
2025-12-29 16:03:41,950 -   Materializing state table (30s cadence) for 2025-12-16...
2025-12-29 16:03:41,963 - [3.0.0] Stage 'materialize_state_table' failed: Invalid comparison between dtype=datetime64[ns] and Timestamp
Traceback (most recent call last):
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arrays/datetimelike.py", line 559, in _validate_comparison_value
    self._check_compatible_with(other)
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arrays/datetimes.py", line 542, in _check_compatible_with
    self._assert_tzawareness_compat(other)
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arrays/datetimes.py", line 784, in _assert_tzawareness_compat
    raise TypeError(
TypeError: Cannot compare tz-naive and tz-aware datetime-like objects.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arrays/datetimelike.py", line 1006, in _cmp_method
    other = self._validate_comparison_value(other)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arrays/datetimelike.py", line 562, in _validate_comparison_value
    raise InvalidComparison(other) from err
pandas.errors.InvalidComparison: 2025-12-16 09:45:00-05:00

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/scripts/run_pipeline_incremental.py", line 223, in main
    signals_df = pipeline.run(
                 ^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/src/pipeline/core/pipeline.py", line 141, in run
    ctx = stage.run(ctx)
          ^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/src/pipeline/core/stage.py", line 65, in run
    outputs = self.execute(ctx)
              ^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/src/pipeline/stages/materialize_state_table.py", line 251, in execute
    state_df = materialize_state_table(
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/src/pipeline/stages/materialize_state_table.py", line 80, in materialize_state_table
    (signals_sorted['timestamp'] >= or_establishment)
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/ops/common.py", line 76, in new_method
    return method(self, other)
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arraylike.py", line 60, in __ge__
    return self._cmp_method(other, operator.ge)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/series.py", line 6138, in _cmp_method
    res_values = ops.comparison_op(lvalues, rvalues, op)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/ops/array_ops.py", line 330, in comparison_op
    res_values = op(lvalues, rvalues)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/ops/common.py", line 76, in new_method
    return method(self, other)
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arraylike.py", line 60, in __ge__
    return self._cmp_method(other, operator.ge)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/arrays/datetimelike.py", line 1008, in _cmp_method
    return invalid_comparison(self, other, op)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/loganrobbins/research/qmachina/spymaster/backend/.venv/lib/python3.12/site-packages/pandas/core/ops/invalid.py", line 40, in invalid_comparison
    raise TypeError(f"Invalid comparison between dtype={left.dtype} and {typ}")
TypeError: Invalid comparison between dtype=datetime64[ns] and Timestamp
Running ES pipeline for 2025-12-16
Checkpoints: data/checkpoints
Resuming from stage: 16
Stopping at stage: 16


Pipeline failed: Invalid comparison between dtype=datetime64[ns] and Timestamp
