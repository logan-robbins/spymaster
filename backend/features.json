{
  "description": "ES 0DTE Multi-Window Physics Features for Neuro-Hybrid Attribution",
  "output_path": "data/lake/gold/training/signals_production.parquet",
  "label_column": "outcome",
  "label_values": ["BREAK", "BOUNCE", "CHOP", "UNDEFINED"],
  "pipeline": "src.pipeline.pipelines.es_pipeline",
  "inference_cadence": "2-minute candle close (continuous, not just touches)",
  "architecture": "ES futures + ES 0DTE options (perfect alignment)",
  "features": {
    "identity": {
      "description": "Signal identification fields",
      "columns": {
        "event_id": {
          "dtype": "string",
          "description": "Deterministic event identifier (hash of date, level_kind, level_price, ts_ns, direction). Reproducible for retrieval.",
          "format": "{date}_{level_kind_name}_{level_price}_{ts_ns}_{direction}",
          "example": "20251203_PM_HIGH_6900.0_1733243400000000000_UP"
        },
        "ts_ns": {
          "dtype": "int64",
          "description": "Event timestamp in Unix nanoseconds UTC",
          "example": 1765843200000000000
        },
        "confirm_ts_ns": {
          "dtype": "int64",
          "description": "Confirmation timestamp (t1 = t0 + 240s = 4 minutes) in Unix nanoseconds UTC (nullable)",
          "example": 1765843440000000000
        },
        "date": {
          "dtype": "string",
          "description": "Trading date (YYYY-MM-DD)",
          "example": "2025-12-17"
        },
        "symbol": {
          "dtype": "string",
          "description": "Underlying symbol (always ES)",
          "example": "ES"
        }
      }
    },
    "level": {
      "description": "Price level characteristics",
      "columns": {
        "spot": {
          "dtype": "float64",
          "description": "Current ES futures price at signal time (index points)",
          "example": 6920.0
        },
        "level_price": {
          "dtype": "float64",
          "description": "Price of the level being tested (ES index points)",
          "example": 6900.0
        },
        "level_kind": {
          "dtype": "int8",
          "description": "Integer code for level type",
          "mapping": {
            "0": "PM_HIGH - Pre-market high (04:00-09:30 ET from ES futures)",
            "1": "PM_LOW - Pre-market low (04:00-09:30 ET from ES futures)",
            "2": "OR_HIGH - Opening range high (09:30-09:45 ET from ES futures)",
            "3": "OR_LOW - Opening range low (09:30-09:45 ET from ES futures)",
          "6": "SMA_200 - 200-period moving average on 2-min ES bars",
          "12": "SMA_400 - 400-period moving average on 2-min ES bars"
        },
        "note": "6 level kinds: 4 structural (PM/OR high/low) + 2 moving averages (SMA_200/400)",
          "example": 0
        },
        "level_kind_name": {
          "dtype": "string",
          "description": "Human-readable level type name",
          "values": ["PM_HIGH", "PM_LOW", "OR_HIGH", "OR_LOW", "SMA_200", "SMA_400"],
          "note": "6 level kinds in ES system",
          "example": "PM_HIGH"
        },
        "direction": {
          "dtype": "string",
          "description": "Direction of approach to level",
          "values": ["UP", "DOWN"],
          "example": "UP"
        },
        "direction_sign": {
          "dtype": "int8",
          "description": "Direction sign (UP=1, DOWN=-1)",
          "example": 1
        },
        "distance": {
          "dtype": "float64",
          "description": "Distance from spot to level in ES index points (filtered to <= 10.0 pts)",
          "example": 4.5
        },
        "distance_signed": {
          "dtype": "float64",
          "description": "Signed distance from spot to level (level_price - spot) in ES points",
          "example": -4.5
        },
        "atr": {
          "dtype": "float64",
          "description": "ATR (1-min bars) at signal time for normalization (ES points)",
          "example": 12.5
        },
        "distance_atr": {
          "dtype": "float64",
          "description": "ATR-normalized distance from spot to level",
          "example": 0.36
        },
        "distance_pct": {
          "dtype": "float64",
          "description": "Spot-normalized distance from spot to level",
          "example": 0.00065
        },
        "distance_signed_atr": {
          "dtype": "float64",
          "description": "ATR-normalized signed distance from spot to level",
          "example": -0.36
        },
        "distance_signed_pct": {
          "dtype": "float64",
          "description": "Spot-normalized signed distance from spot to level",
          "example": -0.00065
        },
        "level_price_pct": {
          "dtype": "float64",
          "description": "Level price expressed as percent difference from spot",
          "example": -0.00065
        }
      }
    },
    "context": {
      "description": "Market context and timing features",
      "columns": {
        "is_first_15m": {
          "dtype": "bool",
          "description": "Whether event occurred in first 15 minutes of trading (09:30-09:45 ET). High volatility period.",
          "example": false
        },
        "dist_to_pm_high": {
          "dtype": "float64",
          "description": "Signed distance from target level to pre-market high (level_price - PM high)",
          "example": 0.15
        },
        "dist_to_pm_low": {
          "dtype": "float64",
          "description": "Signed distance from target level to pre-market low (level_price - PM low)",
          "example": -0.40
        },
        "dist_to_pm_high_atr": {
          "dtype": "float64",
          "description": "ATR-normalized distance from target level to pre-market high",
          "example": 0.35
        },
        "dist_to_pm_high_pct": {
          "dtype": "float64",
          "description": "Spot-normalized distance from target level to pre-market high",
          "example": 0.0005
        },
        "dist_to_pm_low_atr": {
          "dtype": "float64",
          "description": "ATR-normalized distance from target level to pre-market low",
          "example": -0.45
        },
        "dist_to_pm_low_pct": {
          "dtype": "float64",
          "description": "Spot-normalized distance from target level to pre-market low",
          "example": -0.0006
        }
      }
    },
    "mean_reversion": {
      "description": "SMA-based mean reversion context (2-minute bars)",
      "columns": {
        "sma_200": {
          "dtype": "float64",
          "description": "SMA-200 value at event time (2-min bars)",
          "example": 684.25
        },
        "sma_400": {
          "dtype": "float64",
          "description": "SMA-400 value at event time (2-min bars)",
          "example": 682.90
        },
        "dist_to_sma_200": {
          "dtype": "float64",
          "description": "Signed distance from target level to SMA-200 (level_price - SMA)",
          "example": 0.25
        },
        "dist_to_sma_400": {
          "dtype": "float64",
          "description": "Signed distance from target level to SMA-400 (level_price - SMA)",
          "example": 0.80
        },
        "dist_to_sma_200_atr": {
          "dtype": "float64",
          "description": "ATR-normalized distance from target level to SMA-200",
          "example": 0.60
        },
        "dist_to_sma_200_pct": {
          "dtype": "float64",
          "description": "Spot-normalized distance from target level to SMA-200",
          "example": 0.0004
        },
        "dist_to_sma_400_atr": {
          "dtype": "float64",
          "description": "ATR-normalized distance from target level to SMA-400",
          "example": 0.80
        },
        "dist_to_sma_400_pct": {
          "dtype": "float64",
          "description": "Spot-normalized distance from target level to SMA-400",
          "example": 0.0006
        },
        "sma_200_slope": {
          "dtype": "float64",
          "description": "SMA-200 slope in $/min over rolling window",
          "example": 0.02
        },
        "sma_400_slope": {
          "dtype": "float64",
          "description": "SMA-400 slope in $/min over rolling window",
          "example": 0.01
        },
        "sma_200_slope_5bar": {
          "dtype": "float64",
          "description": "SMA-200 slope in $/min over last 5x2min bars",
          "example": 0.03
        },
        "sma_400_slope_5bar": {
          "dtype": "float64",
          "description": "SMA-400 slope in $/min over last 5x2min bars",
          "example": 0.02
        },
        "sma_spread": {
          "dtype": "float64",
          "description": "SMA-200 minus SMA-400 (trend regime proxy)",
          "example": 1.35
        },
        "mean_reversion_pressure_200": {
          "dtype": "float64",
          "description": "Distance to SMA-200 normalized by intraday volatility",
          "example": 1.20
        },
        "mean_reversion_pressure_400": {
          "dtype": "float64",
          "description": "Distance to SMA-400 normalized by intraday volatility",
          "example": 1.80
        },
        "mean_reversion_velocity_200": {
          "dtype": "float64",
          "description": "Change in distance to SMA-200 per minute",
          "example": -0.03
        },
        "mean_reversion_velocity_400": {
          "dtype": "float64",
          "description": "Change in distance to SMA-400 per minute",
          "example": -0.02
        }
      }
    },
    "barrier_physics": {
      "description": "Order book liquidity dynamics (ES futures MBP-10)",
      "source": "batch_engines.compute_barrier_metrics_batch",
      "methodology": {
        "price_units": "ES index points (futures and options use same scale - no conversion)",
        "zone_definition": "±8 ES ticks (±2.0 ES points) for barrier depth analysis around level",
        "forward_window": "240 seconds (4 minutes) from touch timestamp for confirmation window"
      },
      "columns": {
        "barrier_state": {
          "dtype": "string",
          "description": "Classified liquidity state at level",
          "values": ["VACUUM", "WALL", "ABSORPTION", "CONSUMED", "WEAK", "NEUTRAL"],
          "physics": {
            "VACUUM": "Liquidity pulled away without fills - easy break expected",
            "WALL": "Liquidity actively replenishing despite fills - likely reject",
            "ABSORPTION": "Large orders absorbing flow, depth stable",
            "CONSUMED": "Defending liquidity was filled (not pulled) - contested",
            "WEAK": "Minimal liquidity present at level",
            "NEUTRAL": "No significant liquidity signal"
          },
          "example": "WALL"
        },
        "barrier_delta_liq": {
          "dtype": "float64",
          "description": "Net change in defending liquidity (ES contracts). Negative = liquidity leaving.",
          "example": -150.0
        },
        "barrier_delta_liq_nonzero": {
          "dtype": "int8",
          "description": "Indicator that barrier_delta_liq is non-zero",
          "example": 1
        },
        "barrier_delta_liq_log": {
          "dtype": "float64",
          "description": "Signed log transform of barrier_delta_liq",
          "example": -5.02
        },
        "barrier_replenishment_ratio": {
          "dtype": "float64",
          "description": "Ratio of added to removed liquidity. >1.5 = WALL, <0.3 = VACUUM.",
          "example": 1.8
        },
        "wall_ratio": {
          "dtype": "float64",
          "description": "Ratio of defending liquidity to baseline. Detects unusual concentration.",
          "example": 2.1
        },
        "wall_ratio_nonzero": {
          "dtype": "int8",
          "description": "Indicator that wall_ratio is non-zero",
          "example": 0
        },
        "wall_ratio_log": {
          "dtype": "float64",
          "description": "Signed log transform of wall_ratio",
          "example": 1.13
        }
      }
    },
    "tape_physics": {
      "description": "Trade flow momentum (ES futures time & sales)",
      "source": "batch_engines.compute_tape_metrics_batch",
      "methodology": {
        "price_band": "5.0 ES points around level (tape flow analysis zone)",
        "forward_window": "60 seconds from touch timestamp"
      },
      "columns": {
        "tape_imbalance": {
          "dtype": "float64",
          "description": "Buy/sell imbalance in price band around level. Range [-1, 1]. Positive = buy pressure.",
          "example": 0.35
        },
        "tape_buy_vol": {
          "dtype": "int64",
          "description": "Buy volume (contracts) in price band during window",
          "example": 1250
        },
        "tape_sell_vol": {
          "dtype": "int64",
          "description": "Sell volume (contracts) in price band during window",
          "example": 980
        },
        "tape_velocity": {
          "dtype": "float64",
          "description": "Trade arrival rate (trades per second) in window",
          "example": 45.2
        },
        "sweep_detected": {
          "dtype": "bool",
          "description": "Whether a sweep (rapid multi-level execution) was detected",
          "example": false
        }
      }
    },
    "fuel_physics": {
      "description": "Dealer gamma hedging dynamics (ES 0DTE options - same underlying as ES futures)",
      "source": "batch_engines.compute_fuel_metrics_batch",
      "methodology": {
        "greeks": "Black-76 (options on futures) with real-time IV estimation (vectorized numpy)",
        "aggressor_inference": "Tick Rule (uptick=BUY, downtick=SELL)",
        "gamma_flow": "Customer trade direction * size * gamma * 50 (ES contract multiplier)"
      },
      "columns": {
        "gamma_exposure": {
          "dtype": "float64",
          "description": "Net dealer gamma exposure at level. Negative = dealers short gamma (must chase). Positive = dealers long gamma (will fade).",
          "example": 31452.29
        },
        "fuel_effect": {
          "dtype": "string",
          "description": "Classified gamma effect on price movement",
          "values": ["AMPLIFY", "DAMPEN", "NEUTRAL"],
          "physics": {
            "AMPLIFY": "Dealers short gamma - will chase moves, accelerating breakouts",
            "DAMPEN": "Dealers long gamma - will fade moves, supporting mean reversion",
            "NEUTRAL": "No significant gamma imbalance"
          },
          "example": "DAMPEN"
        },
        "gamma_bucket": {
          "dtype": "string",
          "description": "Gamma regime bucket for retrieval filters",
          "values": ["SHORT_GAMMA", "LONG_GAMMA", "UNKNOWN"],
          "example": "LONG_GAMMA"
        }
      }
    },
    "multiwindow_ofi": {
      "description": "Multi-window order flow imbalance features",
      "source": "compute_multiwindow_ofi",
      "methodology": {
        "windows": "30s, 60s, 120s, 300s (multi-scale pressure encoding)",
        "purpose": "Capture order flow pressure dynamics across timescales"
      },
      "columns": {
        "integrated_ofi_30s": {
          "dtype": "float64",
          "description": "Integrated OFI over last 30 seconds. Immediate pressure.",
          "example": 850.0
        },
        "integrated_ofi_60s": {
          "dtype": "float64",
          "description": "Integrated OFI over last 60 seconds. Short-term flow.",
          "example": 1200.0
        },
        "integrated_ofi_120s": {
          "dtype": "float64",
          "description": "Integrated OFI over last 120 seconds. Medium-term cumulative pressure.",
          "example": 2100.0
        },
        "integrated_ofi_300s": {
          "dtype": "float64",
          "description": "Integrated OFI over last 300 seconds. Long-term order flow trend.",
          "example": 4500.0
        },
        "ofi_trend_60s": {
          "dtype": "float64",
          "description": "OFI slope over 60s window (pressure accelerating or fading).",
          "example": 15.0
        },
        "ofi_trend_120s": {
          "dtype": "float64",
          "description": "OFI slope over 120s window.",
          "example": 8.5
        },
        "ofi_trend_300s": {
          "dtype": "float64",
          "description": "OFI slope over 300s window.",
          "example": 3.2
        },
        "ofi_variance_120s": {
          "dtype": "float64",
          "description": "OFI volatility over 120s (flow stability).",
          "example": 120.0
        },
        "ofi_peak_120s": {
          "dtype": "float64",
          "description": "Maximum OFI spike in 120s window.",
          "example": 1800.0
        }
      }
    },
    "barrier_evolution": {
      "description": "Barrier depth evolution features (liquidity dynamics)",
      "source": "compute_barrier_evolution",
      "methodology": {
        "windows": "1min, 3min, 5min (depth changes over time)",
        "purpose": "Detect thinning barrier (bullish BREAK) vs thickening barrier (bullish BOUNCE)"
      },
      "columns": {
        "barrier_depth_current": {
          "dtype": "float64",
          "description": "Current depth at level (ES contracts).",
          "example": 2500.0
        },
        "barrier_depth_change_1min": {
          "dtype": "float64",
          "description": "Depth change over last 1 minute (negative = thinning).",
          "example": -350.0
        },
        "barrier_depth_change_3min": {
          "dtype": "float64",
          "description": "Depth change over last 3 minutes.",
          "example": -800.0
        },
        "barrier_depth_change_5min": {
          "dtype": "float64",
          "description": "Depth change over last 5 minutes.",
          "example": -1200.0
        },
        "barrier_slope_3min": {
          "dtype": "float64",
          "description": "Depth trend over 3min (contracts/min).",
          "example": -120.0
        },
        "barrier_volatility_5min": {
          "dtype": "float64",
          "description": "Depth volatility over 5min (stability measure).",
          "example": 450.0
        },
        "barrier_absorption_rate": {
          "dtype": "float64",
          "description": "Fill rate vs replenishment rate (absorbing vs building).",
          "example": 0.65
        }
      }
    },
    "gex_features": {
      "description": "Strike-banded gamma exposure features",
      "source": "compute_gex_features",
      "methodology": {
        "strike_bands": "±1, ±2, ±3 nearest listed strikes (no fixed spacing assumption)",
        "purpose": "Dealer hedging pressure by proximity to level"
      },
      "columns": {
        "gex_above_1strike": {
          "dtype": "float64",
          "description": "Gamma exposure at the nearest listed strike above the level.",
          "example": 15000.0
        },
        "gex_above_2strike": {
          "dtype": "float64",
          "description": "Gamma exposure at the 2nd nearest listed strike above the level.",
          "example": 35000.0
        },
        "gex_above_3strike": {
          "dtype": "float64",
          "description": "Gamma exposure at the 3rd nearest listed strike above the level.",
          "example": 58000.0
        },
        "gex_below_1strike": {
          "dtype": "float64",
          "description": "Gamma exposure at the nearest listed strike below the level.",
          "example": 12000.0
        },
        "gex_below_2strike": {
          "dtype": "float64",
          "description": "Gamma exposure at the 2nd nearest listed strike below the level.",
          "example": 28000.0
        },
        "gex_below_3strike": {
          "dtype": "float64",
          "description": "Gamma exposure at the 3rd nearest listed strike below the level.",
          "example": 45000.0
        },
        "gex_asymmetry": {
          "dtype": "float64",
          "description": "Net gamma pressure (above - below at 3 strikes).",
          "example": 13000.0
        },
        "gex_ratio": {
          "dtype": "float64",
          "description": "Relative gamma concentration (above / below at 3 strikes).",
          "example": 1.29
        },
        "net_gex_2strike": {
          "dtype": "float64",
          "description": "Net dealer exposure within ±3 nearest listed strikes around the level.",
          "example": 103000.0
        }
      }
    },
    "force_mass": {
      "description": "F=ma physics validation features",
      "source": "compute_force_mass",
      "methodology": {
        "analogy": "F=ma where F=OFI (force), m=barrier_depth (mass), a=acceleration",
        "purpose": "Cross-validate force/mass proxies with observed acceleration"
      },
      "columns": {
        "predicted_accel": {
          "dtype": "float64",
          "description": "Predicted acceleration from F/m (OFI / barrier_depth).",
          "example": 0.35
        },
        "actual_accel": {
          "dtype": "float64",
          "description": "Observed acceleration from kinematics.",
          "example": 0.52
        },
        "fma_residual": {
          "dtype": "float64",
          "description": "Actual - predicted (hidden momentum or absorption).",
          "example": 0.17
        },
        "fma_ratio": {
          "dtype": "float64",
          "description": "Actual / predicted (>1 = price moved more than liquidity suggests).",
          "example": 1.49
        }
      }
    },
    "level_distances_extended": {
      "description": "Extended structural level distances (includes OR levels)",
      "source": "compute_level_distances",
      "columns": {
        "dist_to_or_high": {
          "dtype": "float64",
          "description": "Signed distance from target level to opening range high.",
          "example": 8.5
        },
        "dist_to_or_low": {
          "dtype": "float64",
          "description": "Signed distance from target level to opening range low.",
          "example": -12.3
        },
        "dist_to_or_high_atr": {
          "dtype": "float64",
          "description": "ATR-normalized distance to OR high.",
          "example": 0.68
        },
        "dist_to_or_low_atr": {
          "dtype": "float64",
          "description": "ATR-normalized distance to OR low.",
          "example": -0.98
        }
      }
    },
    "approach_context": {
      "description": "MULTI-WINDOW backward-looking features capturing setup at multiple timescales",
      "source": "compute_multiwindow_kinematics + compute_approach_context",
      "methodology": {
        "windows": "1min, 3min, 5min, 10min, 20min (multi-scale setup encoding)",
        "inference_cadence": "Every 2-minute candle close (continuous, not just touches)",
        "purpose": "Encode HOW price approached level across timescales for kNN retrieval"
      },
      "columns": {
        "velocity_1min": {
          "dtype": "float64",
          "description": "Level-frame velocity over last 1 minute (ES pts/min). Immediate entry dynamics.",
          "example": 4.2
        },
        "velocity_3min": {
          "dtype": "float64",
          "description": "Level-frame velocity over last 3 minutes. Short-term momentum.",
          "example": 3.1
        },
        "velocity_5min": {
          "dtype": "float64",
          "description": "Level-frame velocity over last 5 minutes. Medium-term approach.",
          "example": 2.5
        },
        "velocity_10min": {
          "dtype": "float64",
          "description": "Level-frame velocity over last 10 minutes. Long-term trend.",
          "example": 1.8
        },
        "velocity_20min": {
          "dtype": "float64",
          "description": "Level-frame velocity over last 20 minutes. Pre-approach context.",
          "example": 1.2
        },
        "acceleration_1min": {
          "dtype": "float64",
          "description": "Level-frame acceleration over last 1 minute (pts/min²). Rate of velocity change.",
          "example": 0.8
        },
        "acceleration_3min": {
          "dtype": "float64",
          "description": "Level-frame acceleration over last 3 minutes.",
          "example": 0.5
        },
        "acceleration_5min": {
          "dtype": "float64",
          "description": "Level-frame acceleration over last 5 minutes.",
          "example": 0.3
        },
        "acceleration_10min": {
          "dtype": "float64",
          "description": "Level-frame acceleration over last 10 minutes.",
          "example": 0.2
        },
        "jerk_1min": {
          "dtype": "float64",
          "description": "Level-frame jerk over last 1 minute (pts/min³). Rate of acceleration change.",
          "example": 0.15
        },
        "jerk_3min": {
          "dtype": "float64",
          "description": "Level-frame jerk over last 3 minutes.",
          "example": 0.08
        },
        "jerk_5min": {
          "dtype": "float64",
          "description": "Level-frame jerk over last 5 minutes.",
          "example": 0.05
        },
        "jerk_10min": {
          "dtype": "float64",
          "description": "Level-frame jerk over last 10 minutes.",
          "example": 0.02
        },
        "approach_velocity": {
          "dtype": "float64",
          "description": "Price change per minute over 10min window (ES pts/min). Superseded by multi-window velocity features.",
          "example": 3.5
        },
        "approach_bars": {
          "dtype": "int32",
          "description": "Number of consecutive 1-min bars moving toward level before touch",
          "example": 4
        },
        "approach_distance": {
          "dtype": "float64",
          "description": "Total price distance traveled toward level in 10min window",
          "example": 1.50
        },
        "approach_distance_atr": {
          "dtype": "float64",
          "description": "ATR-normalized approach distance",
          "example": 3.20
        },
        "approach_distance_pct": {
          "dtype": "float64",
          "description": "Spot-normalized approach distance",
          "example": 0.0023
        },
        "prior_touches": {
          "dtype": "int32",
          "description": "Count of prior signals for this level today (monitored events, not literal touches)",
          "example": 2
        },
        "attempt_index": {
          "dtype": "int32",
          "description": "Attempt index within touch cluster (1,2,3...)",
          "example": 2
        },
        "attempt_cluster_id": {
          "dtype": "int32",
          "description": "Cluster identifier for repeated attempts at a level",
          "example": 1
        },
        "barrier_replenishment_trend": {
          "dtype": "float64",
          "description": "Change in barrier replenishment ratio vs first attempt",
          "example": -0.4
        },
        "barrier_delta_liq_trend": {
          "dtype": "float64",
          "description": "Change in barrier delta liquidity vs first attempt",
          "example": -120.0
        },
        "tape_velocity_trend": {
          "dtype": "float64",
          "description": "Change in tape velocity vs first attempt",
          "example": 0.12
        },
        "tape_imbalance_trend": {
          "dtype": "float64",
          "description": "Change in tape imbalance vs first attempt",
          "example": -0.18
        },
        "bars_since_open": {
          "dtype": "int32",
          "description": "Number of 1-min bars since 09:30 ET (RTH-only data expected 0-240)",
          "example": 120
        }
      }
    },
    "outcome": {
      "description": "Ground truth label for supervised learning (triple-barrier labeling)",
      "methodology": {
        "threshold": "15.0 ES points (3 strikes @ 5pt spacing) - tight ATM focus for ES 0DTE",
        "time_to_thresholds": "5.0 pts (1 strike) and 15.0 pts (3 strikes) for time-to-threshold metrics",
        "lookforward": "8 minutes anchored at confirmation time t1",
        "barrier_model": "Competing risks: first barrier hit wins (break vs bounce vs vertical)",
        "missing_data_policy": "If lookforward window is incomplete, outcome is UNDEFINED"
      },
      "columns": {
        "outcome": {
          "dtype": "string",
          "description": "Outcome determined by triple-barrier labeling",
          "values": ["BREAK", "BOUNCE", "CHOP", "UNDEFINED"],
          "labeling": {
            "BREAK": "Price moved +15.0 ES points (3 strikes) in approach direction from level L",
            "BOUNCE": "Price moved -15.0 ES points (3 strikes) opposite approach direction from level L",
            "CHOP": "Neither barrier hit within 8-minute forward window (vertical barrier)",
            "UNDEFINED": "Insufficient forward window to label outcome"
          },
          "example": "BOUNCE"
        },
        "future_price": {
          "dtype": "float64",
          "description": "ES futures price (index points) at end of forward window after confirmation time (t1)",
          "example": 6814.25
        },
        "anchor_spot": {
          "dtype": "float64",
          "description": "Spot price at confirmation time t1 (bar open when aligned)",
          "example": 682.10
        },
        "tradeable_1": {
          "dtype": "int8",
          "description": "Reached 5 ES points (1 strike) in either direction within forward window",
          "example": 1
        },
        "tradeable_2": {
          "dtype": "int8",
          "description": "Reached 15 ES points (3 strikes) in either direction within forward window",
          "example": 0
        },
        "excursion_max": {
          "dtype": "float64",
          "description": "Maximum excursion in approach direction relative to level price L",
          "example": 2.50
        },
        "excursion_min": {
          "dtype": "float64",
          "description": "Maximum excursion opposite approach direction relative to level price L",
          "example": 0.80
        },
        "strength_signed": {
          "dtype": "float64",
          "description": "Signed strength: break-direction excursion minus opposite (relative to level price L)",
          "example": 1.70
        },
        "strength_abs": {
          "dtype": "float64",
          "description": "Absolute max excursion in either direction relative to level price L",
          "example": 2.10
        },
        "time_to_threshold_1": {
          "dtype": "float64",
          "description": "Seconds to first 5 ES point (1 strike) move in either direction from level L",
          "example": 90.0
        },
        "time_to_threshold_2": {
          "dtype": "float64",
          "description": "Seconds to first 15 ES point (3 strike) move in either direction from level L",
          "example": 210.0
        },
        "time_to_break_1": {
          "dtype": "float64",
          "description": "Seconds to first 5 ES point move in break direction from level L",
          "example": 60.0
        },
        "time_to_bounce_1": {
          "dtype": "float64",
          "description": "Seconds to first 5 ES point move in bounce direction from level L",
          "example": 120.0
        },
        "time_to_break_2": {
          "dtype": "float64",
          "description": "Seconds to first 15 ES point move in break direction from level L",
          "example": 150.0
        },
        "time_to_bounce_2": {
          "dtype": "float64",
          "description": "Seconds to first 15 ES point move in bounce direction from level L",
          "example": 210.0
        },
        "outcome_2min": {
          "dtype": "string",
          "description": "Outcome at 2-minute confirmation (fast trades)",
          "values": ["BREAK", "BOUNCE", "CHOP", "UNDEFINED"],
          "example": "CHOP"
        },
        "outcome_4min": {
          "dtype": "string",
          "description": "Outcome at 4-minute confirmation (primary timeframe)",
          "values": ["BREAK", "BOUNCE", "CHOP", "UNDEFINED"],
          "example": "BOUNCE"
        },
        "outcome_8min": {
          "dtype": "string",
          "description": "Outcome at 8-minute confirmation (longer holds)",
          "values": ["BREAK", "BOUNCE", "CHOP", "UNDEFINED"],
          "example": "BREAK"
        },
        "excursion_max_2min": {"dtype": "float64", "description": "Max favorable excursion at 2min", "example": 1.25},
        "excursion_max_4min": {"dtype": "float64", "description": "Max favorable excursion at 4min", "example": 2.50},
        "excursion_max_8min": {"dtype": "float64", "description": "Max favorable excursion at 8min", "example": 3.75},
        "excursion_min_2min": {"dtype": "float64", "description": "Max adverse excursion at 2min", "example": 0.50},
        "excursion_min_4min": {"dtype": "float64", "description": "Max adverse excursion at 4min", "example": 0.80},
        "excursion_min_8min": {"dtype": "float64", "description": "Max adverse excursion at 8min", "example": 1.00},
        "strength_signed_2min": {"dtype": "float64", "description": "Signed strength at 2min", "example": 0.75},
        "strength_signed_4min": {"dtype": "float64", "description": "Signed strength at 4min", "example": 1.70},
        "strength_signed_8min": {"dtype": "float64", "description": "Signed strength at 8min", "example": 2.75},
        "strength_abs_2min": {"dtype": "float64", "description": "Absolute strength at 2min", "example": 1.25},
        "strength_abs_4min": {"dtype": "float64", "description": "Absolute strength at 4min", "example": 2.50},
        "strength_abs_8min": {"dtype": "float64", "description": "Absolute strength at 8min", "example": 3.75},
        "tradeable_1_2min": {"dtype": "int8", "description": "5pt (1 strike) reached at 2min confirmation", "example": 1},
        "tradeable_1_4min": {"dtype": "int8", "description": "5pt (1 strike) reached at 4min confirmation", "example": 1},
        "tradeable_1_8min": {"dtype": "int8", "description": "5pt (1 strike) reached at 8min confirmation", "example": 1},
        "tradeable_2_2min": {"dtype": "int8", "description": "15pt (3 strikes) reached at 2min confirmation", "example": 0},
        "tradeable_2_4min": {"dtype": "int8", "description": "15pt (3 strikes) reached at 4min confirmation", "example": 1},
        "tradeable_2_8min": {"dtype": "int8", "description": "15pt (3 strikes) reached at 8min confirmation", "example": 1},
        "time_to_threshold_1_2min": {"dtype": "float64", "description": "Seconds to 5pt move from 2min confirmation", "example": 45.0},
        "time_to_threshold_1_4min": {"dtype": "float64", "description": "Seconds to 5pt move from 4min confirmation", "example": 90.0},
        "time_to_threshold_1_8min": {"dtype": "float64", "description": "Seconds to 5pt move from 8min confirmation", "example": 120.0},
        "time_to_threshold_2_2min": {"dtype": "float64", "description": "Seconds to 15pt move from 2min confirmation", "example": null},
        "time_to_threshold_2_4min": {"dtype": "float64", "description": "Seconds to 15pt move from 4min confirmation", "example": 180.0},
        "time_to_threshold_2_8min": {"dtype": "float64", "description": "Seconds to 15pt move from 8min confirmation", "example": 210.0},
        "time_to_break_1_2min": {"dtype": "float64", "description": "Seconds to 5pt break from 2min confirmation", "example": 40.0},
        "time_to_break_1_4min": {"dtype": "float64", "description": "Seconds to 5pt break from 4min confirmation", "example": 80.0},
        "time_to_break_1_8min": {"dtype": "float64", "description": "Seconds to 5pt break from 8min confirmation", "example": 110.0},
        "time_to_bounce_1_2min": {"dtype": "float64", "description": "Seconds to 5pt bounce from 2min confirmation", "example": 50.0},
        "time_to_bounce_1_4min": {"dtype": "float64", "description": "Seconds to 5pt bounce from 4min confirmation", "example": 100.0},
        "time_to_bounce_1_8min": {"dtype": "float64", "description": "Seconds to 5pt bounce from 8min confirmation", "example": 130.0},
        "time_to_break_2_2min": {"dtype": "float64", "description": "Seconds to 15pt break from 2min confirmation", "example": null},
        "time_to_break_2_4min": {"dtype": "float64", "description": "Seconds to 15pt break from 4min confirmation", "example": 160.0},
        "time_to_break_2_8min": {"dtype": "float64", "description": "Seconds to 15pt break from 8min confirmation", "example": 200.0},
        "time_to_bounce_2_2min": {"dtype": "float64", "description": "Seconds to 15pt bounce from 2min confirmation", "example": null},
        "time_to_bounce_2_4min": {"dtype": "float64", "description": "Seconds to 15pt bounce from 4min confirmation", "example": 190.0},
        "time_to_bounce_2_8min": {"dtype": "float64", "description": "Seconds to 15pt bounce from 8min confirmation", "example": 230.0},
        "confirm_ts_ns_2min": {"dtype": "int64", "description": "Confirmation timestamp at 2min (nullable)", "example": 1765843320000000000},
        "confirm_ts_ns_4min": {"dtype": "int64", "description": "Confirmation timestamp at 4min (nullable)", "example": 1765843440000000000},
        "confirm_ts_ns_8min": {"dtype": "int64", "description": "Confirmation timestamp at 8min (nullable)", "example": 1765843680000000000},
        "anchor_spot_2min": {"dtype": "float64", "description": "Anchor price at 2min confirmation", "example": 6812.50},
        "anchor_spot_4min": {"dtype": "float64", "description": "Anchor price at 4min confirmation", "example": 6814.00},
        "anchor_spot_8min": {"dtype": "float64", "description": "Anchor price at 8min confirmation", "example": 6816.25},
        "future_price_2min": {"dtype": "float64", "description": "Price at end of 2min forward window", "example": 6810.75},
        "future_price_4min": {"dtype": "float64", "description": "Price at end of 4min forward window", "example": 6804.00},
        "future_price_8min": {"dtype": "float64", "description": "Price at end of 8min forward window", "example": 6799.25}
      }
    }
  },
  "statistics": {
    "generated_at": "2025-12-28",
    "expected_stats": {
      "inference_model": "Continuous (every 2-min candle)",
      "candles_per_day": 120,
      "rows_per_day": 360,
      "filtered_events_per_day": "15-25 (when distance <= MONITOR_BAND)",
      "note": "Sparse high-precision events preferred for kNN retrieval"
    },
    "date_range_example": ["2025-11-02", "2025-11-30"],
    "quality_filter": "distance <= 5.0 ES points (MONITOR_BAND) - interaction zone",
    "expected_outcome_distribution": {
      "BREAK": 0.40,
      "BOUNCE": 0.40,
      "CHOP": 0.20,
      "note": "Target split for 15pt threshold; actual distribution varies by regime and window."
    },
    "barrier_state_distribution": {
      "NEUTRAL": 3180,
      "WEAK": 52,
      "WALL": 53,
      "VACUUM": 43
    },
    "fuel_effect_distribution": {
      "DAMPEN": 0.724,
      "AMPLIFY": 0.095,
      "NEUTRAL": 0.181
    },
    "feature_coverage": {
      "gamma_exposure": {
        "non_null": 1.0,
        "non_zero": 1.0,
        "mean": 33434.27,
        "min": -204008.67,
        "max": 140990.23
      },
      "tape_imbalance": {
        "non_null": 1.0,
        "non_zero": 0.989
      },
      "tape_velocity": {
        "non_null": 1.0,
        "non_zero": 1.0
      },
      "wall_ratio": {
        "non_null": 1.0,
        "non_zero": 0.033,
        "note": "Expected sparse - only detects unusual liquidity concentration at strikes"
      },
      "barrier_delta_liq": {
        "non_null": 1.0,
        "non_zero": 0.048
      },
      "spot": {
        "non_null": 1.0,
        "non_zero": 1.0,
        "expected_mean": 6900.0,
        "expected_min": 6850.0,
        "expected_max": 6980.0,
        "note": "ES index points (e.g., 6920.0)"
      },
      "distance": {
        "non_null": 1.0,
        "non_zero": 0.95,
        "expected_mean": 3.5,
        "expected_min": 0.0,
        "expected_max": 10.0,
        "note": "ES points (filtered to MONITOR_BAND=5.0, continuous inference may have wider range)"
      },
      "velocity_3min": {
        "non_null": 1.0,
        "non_zero": 0.98,
        "expected_mean": 1.5,
        "expected_min": -15.0,
        "expected_max": 15.0,
        "note": "ES points/min (multi-window replaces single approach_velocity)"
      },
      "approach_bars": {
        "non_null": 1.0,
        "non_zero": 0.418,
        "mean": 0.673,
        "min": 0,
        "max": 7
      },
      "approach_distance": {
        "non_null": 1.0,
        "non_zero": 0.979,
        "mean": 1.80,
        "min": 0.0,
        "max": 7.10
      },
      "prior_touches": {
        "non_null": 1.0,
        "non_zero": 0.976,
        "mean": 39.03,
        "min": 0,
        "max": 161,
        "note": "Counts prior signals per level (not literal touches), so higher values are expected."
      },
      "bars_since_open": {
        "non_null": 1.0,
        "non_zero": 1.0,
        "mean": 120.0,
        "min": 0,
        "max": 240,
        "note": "RTH-only data should be 0-240. >240 implies data outside the RTH filter."
      }
    }
  },
  "data_sources": {
    "es_futures": {
      "provider": "Databento",
      "dataset": "GLBX.MDP3 (CME Globex)",
      "format": "DBN (trades + MBP-10)",
      "conversion": "NONE - ES futures in index points (e.g., 6920.0)",
      "front_month_filtering": "Volume-dominant selection, 60% threshold (ContractSelector)",
      "fields": ["ts_event_ns", "symbol", "price", "size", "aggressor", "levels_1-10 (MBP-10)"]
    },
    "es_options": {
      "provider": "Databento",
      "dataset": "GLBX.MDP3 (CME Globex)",
      "format": "Trades + NBBO (MBP-1)",
      "symbol_format": "ESZ5 P6900 (contract + right + strike)",
      "strike_spacing": "5 points (ATM on 0DTE expiry), 25 points (farther OTM/longer-dated)",
      "0dte_filtering": "exp_date == session_date",
      "front_month_filtering": "Same contract as ES futures (e.g., ESZ5)",
      "fields": ["ts_event_ns", "symbol", "price", "size", "bid_px", "ask_px", "bid_sz", "ask_sz"]
    }
  },
  "methodology": {
    "inference_model": "CONTINUOUS (every 2-min candle) not event-based (at touches only)",
    "inference_cadence": "Every 2-minute candle close during RTH (09:30-13:30 ET)",
    "inference_logic": "For each 2-min bar, compute features for NEAREST level in each category (PM/OR/SMA)",
    "distance_weighting": "Accuracy improves as distance-to-level decreases (closer = more confident)",
    
    "multi_window_lookback": "1min, 3min, 5min, 10min, 20min (encode setup shape across timescales)",
    "why_multi_window": "kNN retrieval needs: 'fast accelerating approach' vs 'slow decelerating approach' - single window can't distinguish!",
    
    "greeks_calculation": "Black-76 (options on futures) with vectorized NumPy",
    "aggressor_inference": "Tick Rule: compare trade price to previous trade",
    "0dte_filter": "All option processing restricted to ES 0DTE (same-day expiration)",
    "es_conversion": "NONE - ES futures = ES options (perfect alignment, same underlying!)",
    "barrier_zone": "±8 ES ticks (±2 ES pts) around levels",
    "interaction_zone": "±5 ES points (MONITOR_BAND) for event detection",
    "touch_zone": "±2 ES points (TOUCH_BAND) for precise contact",
    "outcome_threshold": "Move >=15 ES points (3 strikes @ 5pt spacing) for BREAK/BOUNCE",
    "lookback_context": "Multi-window: 1,3,5,10,20 minutes for velocity/OFI/barrier evolution",
    "lookforward_window": "8 minutes from confirmation time for outcome labeling",
    "confirmation_delay": "4 minutes (240s) - Stage B confirmation before labeling",
    "sma_warmup": "SMA-200/400 computed on 2-min bars with up to 3 prior sessions for warmup"
  }
}
