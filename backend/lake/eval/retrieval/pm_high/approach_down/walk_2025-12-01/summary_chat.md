target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
knobs={"horizon": 3, "k_raw": 500, "k_values": [5, 10, 20, 50, 100], "normalization": "robust_l2", "similarity_metric": "inner_product", "tau": 0.03, "tod_minutes": 30}
Table A — Best k per model
target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
| target_id                               | split_id        | level_id   | approach_dir   | model     |   k |      auc |    brier |      ece |   lift_top_decile |   log_loss |    n | selection            |   delta_auc_vs_base_rate |   delta_log_loss_vs_base_rate |   delta_lift_top_decile_vs_base_rate |   delta_ece_vs_base_rate |   delta_auc_vs_null_knn |   delta_log_loss_vs_null_knn |   delta_lift_top_decile_vs_null_knn |   delta_ece_vs_null_knn |
|:----------------------------------------|:----------------|:-----------|:---------------|:----------|----:|---------:|---------:|---------:|------------------:|-----------:|-----:|:---------------------|-------------------------:|------------------------------:|-------------------------------------:|-------------------------:|------------------------:|-----------------------------:|------------------------------------:|------------------------:|
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | base_rate |   5 | 0.5      | 0.070561 | 0.011353 |           1.17494 |   0.27051  | 2269 | min_log_loss|max_auc |                 0        |                      0        |                             0        |                 0        |                0.04434  |                    -0.675732 |                            0.369187 |               -0.098123 |
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | knn       | 100 | 0.846035 | 0.068425 | 0.05074  |           4.14104 |   0.258769 | 2269 | min_log_loss         |                 0.346035 |                     -0.011741 |                             2.9661   |                 0.039388 |                0.364296 |                    -0.035036 |                            2.95565  |                0.027585 |
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | knn       |  50 | 0.847974 | 0.068569 | 0.051252 |           4.14104 |   0.260261 | 2269 | max_auc              |                 0.347974 |                     -0.01025  |                             2.9661   |                 0.039899 |                0.381816 |                    -0.104474 |                            3.04032  |                0.015015 |
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | logit     |   5 | 0.785634 | 0.099067 | 0.092052 |           3.25853 |   0.513591 | 2269 | min_log_loss|max_auc |                 0.285634 |                      0.24308  |                             2.08358  |                 0.080699 |                0.329973 |                    -0.432652 |                            2.45277  |               -0.017424 |
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | null_knn  | 100 | 0.481739 | 0.071733 | 0.023156 |           1.18539 |   0.293805 | 2269 | min_log_loss         |                -0.018261 |                      0.023294 |                             0.010449 |                 0.011803 |                0        |                     0        |                            0        |                0        |
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | null_knn  |  10 | 0.490153 | 0.076994 | 0.071926 |           1.30841 |   0.718341 | 2269 | max_auc              |                -0.009847 |                      0.447831 |                             0.133461 |                 0.060573 |                0        |                     0        |                            0        |                0        |
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | tod_rate  |   5 | 0.495978 | 0.071402 | 0.013975 |           1.90248 |   0.282357 | 2269 | min_log_loss|max_auc |                -0.004022 |                      0.011847 |                             0.727538 |                 0.002623 |                0.040318 |                    -0.663885 |                            1.09672  |               -0.0955   |

Table B — Leaderboard by delta_auc vs null_knn
target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
Top 10
target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
| target_id                               | split_id        | level_id   | approach_dir   | model   |   k |      auc |    brier |      ece |   lift_top_decile |   log_loss |    n | selection   |   delta_auc_vs_base_rate |   delta_log_loss_vs_base_rate |   delta_lift_top_decile_vs_base_rate |   delta_ece_vs_base_rate |   delta_auc_vs_null_knn |   delta_log_loss_vs_null_knn |   delta_lift_top_decile_vs_null_knn |   delta_ece_vs_null_knn |
|:----------------------------------------|:----------------|:-----------|:---------------|:--------|----:|---------:|---------:|---------:|------------------:|-----------:|-----:|:------------|-------------------------:|------------------------------:|-------------------------------------:|-------------------------:|------------------------:|-----------------------------:|------------------------------------:|------------------------:|
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | knn     |  50 | 0.847974 | 0.068569 | 0.051252 |           4.14104 |   0.260261 | 2269 | max_auc     |                 0.347974 |                      -0.01025 |                               2.9661 |                 0.039899 |                0.381816 |                    -0.104474 |                             3.04032 |                0.015015 |

Bottom 10
target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
| target_id                               | split_id        | level_id   | approach_dir   | model   |   k |      auc |    brier |      ece |   lift_top_decile |   log_loss |    n | selection   |   delta_auc_vs_base_rate |   delta_log_loss_vs_base_rate |   delta_lift_top_decile_vs_base_rate |   delta_ece_vs_base_rate |   delta_auc_vs_null_knn |   delta_log_loss_vs_null_knn |   delta_lift_top_decile_vs_null_knn |   delta_ece_vs_null_knn |
|:----------------------------------------|:----------------|:-----------|:---------------|:--------|----:|---------:|---------:|---------:|------------------:|-----------:|-----:|:------------|-------------------------:|------------------------------:|-------------------------------------:|-------------------------:|------------------------:|-----------------------------:|------------------------------------:|------------------------:|
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | knn     |  50 | 0.847974 | 0.068569 | 0.051252 |           4.14104 |   0.260261 | 2269 | max_auc     |                 0.347974 |                      -0.01025 |                               2.9661 |                 0.039899 |                0.381816 |                    -0.104474 |                             3.04032 |                0.015015 |

Shape diagnostics
target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
base_rate=0.064892 n=2269
| metric          |      min |   median |      max |
|:----------------|---------:|---------:|---------:|
| auc             | 0.752762 | 0.842739 | 0.847974 |
| log_loss        | 0.258769 | 0.284161 | 0.500944 |
| ece             | 0.05074  | 0.053556 | 0.064232 |
| lift_top_decile | 4.00527  | 4.14104  | 4.14104  |

Pareto set (AUC high, log_loss low, ECE low)
target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
| target_id                               | split_id        | level_id   | approach_dir   | model   |   k |      auc |    brier |      ece |   lift_top_decile |   log_loss |    n |
|:----------------------------------------|:----------------|:-----------|:---------------|:--------|----:|---------:|---------:|---------:|------------------:|-----------:|-----:|
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | knn     |  50 | 0.847974 | 0.068569 | 0.051252 |           4.14104 |   0.260261 | 2269 |
| true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | walk_2025-12-01 | pm_high    | approach_down  | knn     | 100 | 0.846035 | 0.068425 | 0.05074  |           4.14104 |   0.258769 | 2269 |

Table C — Calibration fixes
target_id=true_outcome_h3:BREAK_DOWN_vs_REJECT_UP | split_id=walk_2025-12-01 | level_id=pm_high | approach_dir=approach_down | train_range=2025-10-01:2025-12-01 | test_range=2025-12-02:2026-01-08 | norm_stats_source=lake/eval/retrieval/pm_high/approach_down/walk_2025-12-01/index/norm_stats.json:1c4a74bad88eabadf01624887bd9fa3b141d3b8990e8c67cc34d4690467e962b | faiss_index_hash=a30f4a55b10d3cea5a98fe2b74265dc9412bff600740326898b4847ea10b5fc8
|   k | method    |   log_loss |      ece |      auc |
|----:|:----------|-----------:|---------:|---------:|
|  50 | knn_raw   |   0.260261 | 0.051252 | 0.847974 |
|  50 | knn_temp  |   0.22144  | 0.046822 | 0.847974 |
|  50 | knn_platt |   0.215889 | 0.024169 | 0.847974 |
|  50 | knn_iso   |   0.218262 | 0.012101 | 0.842568 |
| 100 | knn_raw   |   0.258769 | 0.05074  | 0.846035 |
| 100 | knn_temp  |   0.224872 | 0.05063  | 0.846035 |
| 100 | knn_platt |   0.217784 | 0.023597 | 0.846035 |
| 100 | knn_iso   |   0.219969 | 0.014528 | 0.835952 |