{
    "future_mbo": {
        "bronze": {
            "BronzeIngestFutureMbo": {
                "ts_event": {
                    "built_from": [
                        "raw.market_by_order_dbn.ts_event"
                    ],
                    "transformation_steps": [
                        "Cast to int64",
                        "Output filtered to session window (09:30-09:40 ET for dev)"
                    ]
                },
                "price": {
                    "built_from": [
                        "raw.market_by_order_dbn.price"
                    ],
                    "transformation_steps": [
                        "Cast to int64",
                        "Handle NULL_PRICE (replace with 0 if action is Add/Modify)"
                    ]
                },
                "size": {
                    "built_from": [
                        "raw.market_by_order_dbn.size"
                    ],
                    "transformation_steps": [
                        "Cast to int64"
                    ]
                },
                "action": {
                    "built_from": [
                        "raw.market_by_order_dbn.action"
                    ],
                    "transformation_steps": [
                        "Pass through"
                    ]
                },
                "side": {
                    "built_from": [
                        "raw.market_by_order_dbn.side"
                    ],
                    "transformation_steps": [
                        "Pass through"
                    ]
                },
                "order_id": {
                    "built_from": [
                        "raw.market_by_order_dbn.order_id"
                    ],
                    "transformation_steps": [
                        "Cast to int64"
                    ]
                },
                "flags": {
                    "built_from": [
                        "raw.market_by_order_dbn.flags"
                    ],
                    "transformation_steps": [
                        "Cast to int64"
                    ]
                },
                "instrument_id": {
                    "built_from": [
                        "raw.market_by_order_dbn.instrument_id"
                    ],
                    "transformation_steps": [
                        "Cast to int64"
                    ]
                }
            }
        },
        "silver": {
            "SilverComputeBookStates1s": {
                "book_snapshot_1s": {
                    "window_start_ts_ns": {
                        "built_from": [
                            "bronze.future_mbo.mbo.ts_event"
                        ],
                        "transformation_steps": [
                            "Floor ts_event to 1s bucket (start of window)"
                        ]
                    },
                    "window_end_ts_ns": {
                        "built_from": [
                            "bronze.future_mbo.mbo.ts_event"
                        ],
                        "transformation_steps": [
                            "Ceil ts_event to 1s bucket (end of window)"
                        ]
                    },
                    "best_bid_price_int": {
                        "built_from": [
                            "bronze.future_mbo.mbo.price",
                            "bronze.future_mbo.mbo.side",
                            "bronze.future_mbo.mbo.action"
                        ],
                        "transformation_steps": [
                            "Apply stateful updates (Add/Modify/Cancel/Fill) to internal order map",
                            "Aggregate resting quantity by price level",
                            "Select maximum price with quantity > 0 where side='B' at window_end_ts"
                        ]
                    },
                    "best_bid_qty": {
                        "built_from": [
                            "bronze.future_mbo.mbo.size",
                            "bronze.future_mbo.mbo.side",
                            "bronze.future_mbo.mbo.action"
                        ],
                        "transformation_steps": [
                            "Apply stateful updates to internal order map",
                            "Sum quantity of all active orders at Best Bid Price at window_end_ts"
                        ]
                    },
                    "best_ask_price_int": {
                        "built_from": [
                            "bronze.future_mbo.mbo.price",
                            "bronze.future_mbo.mbo.side",
                            "bronze.future_mbo.mbo.action"
                        ],
                        "transformation_steps": [
                            "Apply stateful updates to internal order map",
                            "Aggregate resting quantity by price level",
                            "Select minimum price with quantity > 0 where side='A' at window_end_ts"
                        ]
                    },
                    "best_ask_qty": {
                        "built_from": [
                            "bronze.future_mbo.mbo.size",
                            "bronze.future_mbo.mbo.side",
                            "bronze.future_mbo.mbo.action"
                        ],
                        "transformation_steps": [
                            "Apply stateful updates to internal order map",
                            "Sum quantity of all active orders at Best Ask Price at window_end_ts"
                        ]
                    },
                    "mid_price": {
                        "built_from": [
                            "best_bid_price_int",
                            "best_ask_price_int"
                        ],
                        "transformation_steps": [
                            "Avg(Best Bid, Best Ask) * PRICE_SCALE (1e-9)"
                        ]
                    },
                    "mid_price_int": {
                        "built_from": [
                            "best_bid_price_int",
                            "best_ask_price_int"
                        ],
                        "transformation_steps": [
                            "Round(Avg(Best Bid, Best Ask))"
                        ]
                    },
                    "last_trade_price_int": {
                        "built_from": [
                            "bronze.future_mbo.mbo.price",
                            "bronze.future_mbo.mbo.action"
                        ],
                        "transformation_steps": [
                            "Filter action='T'",
                            "Take last observed price in window (or carry forward previous)"
                        ]
                    },
                    "spot_ref_price_int": {
                        "built_from": [
                            "last_trade_price_int"
                        ],
                        "transformation_steps": [
                            "Round last_trade_price_int to nearest 20-tick ($5.00) grid anchor"
                        ]
                    },
                    "book_valid": {
                        "built_from": [
                            "internal_state"
                        ],
                        "transformation_steps": [
                            "True if book state is initialized and no Snapshot/Clear flags persisted unexpectedly"
                        ]
                    }
                },
                "depth_and_flow_1s": {
                    "_description": "Granular Market Depth and Order Flow dynamics (Adds/Pulls/Fills) for the Limit Order Book.",
                    "_shape": "Long Format (Panel Data)",
                    "_grain": "1 Second x Price Level (tick)",
                    "_primary_key": [
                        "window_end_ts_ns",
                        "price_int"
                    ],
                    "price_int": {
                        "built_from": [
                            "bronze.future_mbo.mbo.price"
                        ],
                        "transformation_steps": [
                            "Aggregate distinct prices in window +/- 200 ticks from spot"
                        ]
                    },
                    "side": {
                        "built_from": [
                            "bronze.future_mbo.mbo.side"
                        ],
                        "transformation_steps": [
                            "Pass through ('A' or 'B')"
                        ]
                    },
                    "spot_ref_price_int": {
                        "built_from": [
                            "last_trade_price (internal state)"
                        ],
                        "transformation_steps": [
                            "From internal engine state (same as snapshot)"
                        ]
                    },
                    "rel_ticks": {
                        "built_from": [
                            "price_int",
                            "spot_ref_price_int"
                        ],
                        "transformation_steps": [
                            "(price_int - spot_ref_price_int) / TICK_INT",
                            "Round to integer"
                        ]
                    },
                    "depth_qty_start": {
                        "built_from": [
                            "book_state"
                        ],
                        "transformation_steps": [
                            "calculated as: depth_qty_end - add_qty + pull_qty_total + fill_qty"
                        ]
                    },
                    "depth_qty_end": {
                        "built_from": [
                            "bronze.future_mbo.mbo"
                        ],
                        "transformation_steps": [
                            "Quantity remaining at price level at end of window"
                        ]
                    },
                    "add_qty": {
                        "built_from": [
                            "bronze.future_mbo.mbo.action=A"
                        ],
                        "transformation_steps": [
                            "Sum of added volume at price level in window"
                        ]
                    },
                    "pull_qty_total": {
                        "built_from": [
                            "bronze.future_mbo.mbo.action=C|M"
                        ],
                        "transformation_steps": [
                            "Sum of cancelled/reduced volume at price level in window"
                        ]
                    },
                    "depth_qty_rest": {
                        "built_from": [
                            "bronze.future_mbo.mbo"
                        ],
                        "transformation_steps": [
                            "Quantity of orders resting for > 500ms"
                        ]
                    },
                    "pull_qty_rest": {
                        "built_from": [
                            "bronze.future_mbo.mbo"
                        ],
                        "transformation_steps": [
                            "Sum of cancelled volume from orders resting > 500ms"
                        ]
                    },
                    "fill_qty": {
                        "built_from": [
                            "bronze.future_mbo.mbo.action=F"
                        ],
                        "transformation_steps": [
                            "Sum of filled volume at price level in window"
                        ]
                    }
                }
            }
        },
        "gold": {
            "GoldComputePhysicsSurface1s": {
                "physics_surface_1s": {
                    "add_intensity": {
                        "built_from": [
                            "silver.future_mbo.depth_and_flow_1s.add_qty",
                            "silver.future_mbo.depth_and_flow_1s.depth_qty_start"
                        ],
                        "transformation_steps": [
                            "add_qty / (depth_qty_start + 1.0)"
                        ]
                    },
                    "fill_intensity": {
                        "built_from": [
                            "silver.future_mbo.depth_and_flow_1s.fill_qty",
                            "silver.future_mbo.depth_and_flow_1s.depth_qty_start"
                        ],
                        "transformation_steps": [
                            "fill_qty / (depth_qty_start + 1.0)"
                        ]
                    },
                    "pull_intensity": {
                        "built_from": [
                            "silver.future_mbo.depth_and_flow_1s.pull_qty_total",
                            "silver.future_mbo.depth_and_flow_1s.depth_qty_start"
                        ],
                        "transformation_steps": [
                            "pull_qty_total / (depth_qty_start + 1.0)"
                        ]
                    },
                    "liquidity_velocity": {
                        "built_from": [
                            "add_intensity",
                            "pull_intensity",
                            "fill_intensity"
                        ],
                        "transformation_steps": [
                            "add_intensity - pull_intensity - fill_intensity"
                        ],
                        "note": "True net change in liquidity. Positive = building, Negative = eroding (pulls + fills > adds)"
                    }
                }
            },
            "GoldComputePhysicsBands1s": {
                "_status": "PENDING_REDESIGN",
                "_note": "Stage 4 needs update - wall_strength removed from Stage 3. User to address in next task.",
                "physics_bands_1s": {
                    "features": [
                        "add_intensity",
                        "fill_intensity",
                        "pull_intensity",
                        "liquidity_velocity"
                    ],
                    "transformation_steps": [
                        "Band aggregation from physics_surface_1s (At: 0-2, Near: 3-5, Mid: 6-14, Far: 15-20)",
                        "Compute Mean of each intensity metric per Band per Direction"
                    ]
                }
            }
        }
    }
}